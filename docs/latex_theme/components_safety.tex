% ==================================================
% components_safety.tex
% INDUSTRIAL STABLE VERSION (layered params)
% ==================================================

\usepackage{titlesec}
\usepackage[most]{tcolorbox}
\usepackage{array}
\usepackage{graphicx}
\usepackage{multicol}

% ==================================================
% SAFE DEFAULTS (防止参数未定义)
% ==================================================

% NOTE:
% - We keep legacy providecommands for safety, but runtime values come from params.tex via \csname HB<key>\endcsname.
% - Uppercase flags are expected to be numeric (0/1). Ensure csv_to_tex_params treats unit=int as raw number.

\providecommand{\HBtype_warning_text_force_upper}{0}
\providecommand{\HBtype_h1_force_upper}{0}
\providecommand{\HBtype_subbar_force_upper}{0}
\providecommand{\HBtype_body_force_upper}{0}
\providecommand{\HBsection_after_fix}{0pt}

% ==================================================
% WARNING LOCKUP
% ==================================================

\providecommand{\warninglockup}{}
\renewcommand{\warninglockup}{%
  \includegraphics[
    height=\csname HBcomp_lockup_height\endcsname,
    viewport=79 22 2125 549,
    clip
  ]{warning_lockup.png}%
}


% ==================================================
% WARNING BOX
% ==================================================

\newtcolorbox{safetywarningbox}{
  enhanced,
  colback=white,
  colframe=LineK40,
  flush left,
  boxsep=\csname HBcomp_warning_box_sep\endcsname,
  top=\csname HBcomp_warning_box_pad_tb\endcsname,
  bottom=\csname HBcomp_warning_box_pad_tb\endcsname,
  arc=\csname HBcomp_warning_box_arc\endcsname,
  boxrule=\csname HBcomp_warning_box_rule\endcsname,
  left=\csname HBcomp_warning_box_pad_lr\endcsname,
  right=\csname HBcomp_warning_box_pad_lr\endcsname,
  before skip=\csname HBcomp_warning_box_before\endcsname,
  after skip=\csname HBcomp_warning_box_after\endcsname,
  width=\csname HBcomp_warning_box_width\endcsname\textwidth,
}

% ==================================================
% WARNING LAYOUT
% ==================================================

\providecommand{\safetywarning}[1]{}
\renewcommand{\safetywarning}[1]{%
\begin{safetywarningbox}
  \noindent
  \begin{tabular}{@{}m{\csname HBcomp_lockup_width\endcsname}%
                  @{\hspace{\csname HBcomp_lockup_gap\endcsname}}%
                  m{\dimexpr\textwidth-\csname HBcomp_lockup_width\endcsname-\csname HBcomp_lockup_gap\endcsname\relax}@{}}
    \centering\warninglockup
    &
    \raggedright
    {\bfseries
    \color{\csname HBtype_warning_text_color\endcsname}
    \fontsize{\csname HBtype_warning_text_font_size\endcsname}
             {\csname HBtype_warning_text_font_leading\endcsname}
    \selectfont
     #1
    }
  \end{tabular}
\end{safetywarningbox}
}

% ==================================================
% SUBBAR
% ==================================================

\providecommand{\safetysubbar}[1]{}
\renewcommand{\safetysubbar}[1]{%
  \begin{tcolorbox}[
    colback=BrandDark,
    colframe=BrandDark,
    arc=\csname HBcomp_subbar_arc\endcsname,
    left=\csname HBcomp_subbar_pad_lr\endcsname,
    right=\csname HBcomp_subbar_pad_lr\endcsname,
    top=\csname HBcomp_subbar_pad_tb\endcsname,
    bottom=\csname HBcomp_subbar_pad_tb\endcsname,
    boxrule=0pt,
    width=\csname HBcomp_subbar_width\endcsname\textwidth
  ]
  {\color{white}\bfseries
   \fontsize{\csname HBtype_subbar_font_size\endcsname}{\csname HBtype_subbar_font_leading\endcsname}\selectfont
   #1}
  \end{tcolorbox}
  \par\noindent
  \vspace*{\csname HBcomp_subbar_after\endcsname}%
  \vspace*{-\csname HBcomp_subbar_tighten\endcsname}%
}

% ==================================================
% TWO COLUMN
% ==================================================

\setlength{\columnsep}{\csname HBcomp_twocol_sep\endcsname}

\newenvironment{safetytwocol}{%
  \par\noindent
  \vspace*{-\csname HBcomp_twocol_tighten\endcsname}%
  \begin{multicols}{2}
    \normalfont\mdseries
    \color{\csname HBtype_list_color\endcsname}
    \fontsize{\csname HBtype_list_font_size\endcsname}{\csname HBtype_list_font_leading\endcsname}\selectfont 
}{%
  \end{multicols}
  \par
}


% ==================================================
% H1 PILL
% ==================================================

\providecommand{\hbsectiontitle}[1]{#1}

\renewcommand{\hbsectiontitle}[1]{%
  \par\noindent
  \hspace*{-\leftskip}%
  \begin{tcolorbox}[
    colback=BrandDark,
    colframe=BrandDark,
    arc=\csname HBcomp_h1_pill_arc\endcsname,
    rounded corners=south,
    sharp corners=north,
    boxrule=0pt,
    left=\csname HBcomp_h1_pill_pad_lr\endcsname,
    right=\csname HBcomp_h1_pill_pad_lr\endcsname,
    top=\csname HBcomp_h1_pill_pad_tb\endcsname,
    bottom=\csname HBcomp_h1_pill_pad_tb\endcsname,
    width=\csname HBcomp_h1_pill_width\endcsname\textwidth,
    before skip=0mm,
    after skip=\csname HBcomp_h1_pill_after\endcsname
  ]
  {\color{white}\bfseries
   \fontsize{\csname HBtype_h1_font_size\endcsname}{\csname HBtype_h1_font_leading\endcsname}\selectfont
   #1}
  \end{tcolorbox}%
  \par\noindent
}

% ==================================================
% LEAD
% ==================================================

\providecommand{\safetylead}[1]{}
\renewcommand{\safetylead}[1]{%
  \par\noindent
  {\bfseries
   \color{\csname HBtype_body_color\endcsname}
   \fontsize{\csname HBtype_body_font_size\endcsname}{\csname HBtype_body_font_leading\endcsname}\selectfont
   #1}
   \par\vspace{\csname HBcomp_lead_after\endcsname}%
}

% ==================================================
% SECTION PATCH
% ==================================================

\titleformat{\section}{\normalfont}{}{0pt}{\hbsectiontitle}
\titlespacing*{\section}{0pt}{0pt}{\csname HBsection_after_fix\endcsname}
\setcounter{secnumdepth}{0}
