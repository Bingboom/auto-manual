% ==================================================
% components_safety.tex
% 安全页专用组件（WARNING / subbar / two-col / section title）
% Parameter access: \csname HB<key>\endcsname
% ==================================================

\usepackage{titlesec}
\usepackage[most]{tcolorbox}

% --------------------------------------------------
% WARNING icon (TikZ) - parameterized
% --------------------------------------------------
\newcommand{\warnicon}{%
\begin{tikzpicture}[x=1em,y=1em,baseline=-0.25em,scale=\csname HBwarn_icon_scale\endcsname]
  \path[fill=BrandDark,draw=BrandDark,rounded corners=\csname HBwarn_icon_round\endcsname]
    (0.00,0.00) -- (\csname HBwarn_icon_w\endcsname,0.00) --
    (0.5*\csname HBwarn_icon_w\endcsname,\csname HBwarn_icon_h\endcsname) -- cycle;
  \node[color=white,font=\bfseries\fontsize{\csname HBwarn_icon_excl_size\endcsname}{\csname HBwarn_icon_excl_size\endcsname}\selectfont]
    at (0.5*\csname HBwarn_icon_w\endcsname,\csname HBwarn_icon_excl_y\endcsname) {!};
\end{tikzpicture}%
}

% --------------------------------------------------
% WARNING box - parameterized
% --------------------------------------------------
\newtcolorbox{safetywarningbox}{
  enhanced,
  colback=white,
  colframe=LineK40,
  arc=\csname HBwarn_box_arc\endcsname,
  boxrule=\csname HBwarn_box_rule\endcsname,
  left=\csname HBwarn_box_pad_lr\endcsname,
  right=\csname HBwarn_box_pad_lr\endcsname,
  top=\csname HBwarn_box_pad_tb\endcsname,
  bottom=\csname HBwarn_box_pad_tb\endcsname,
  before skip=\csname HBwarn_box_before\endcsname,
  after skip=\csname HBwarn_box_after\endcsname,
}

% --------------------------------------------------
% WARNING layout - parameterized
% --------------------------------------------------
\newcommand{\safetywarning}[2]{%
\begin{safetywarningbox}
  \setlength{\tabcolsep}{0pt}
  \renewcommand{\arraystretch}{1.0}
  \begin{tabularx}{\textwidth}{@{}p{\csname HBwarn_col_icon\endcsname} p{\csname HBwarn_col_label\endcsname} X@{}}
    \raggedright\warnicon &
    \raggedright{\bfseries\fontsize{\csname HBwarn_label_size\endcsname}{\csname HBwarn_label_leading\endcsname}\selectfont #1} &
    \raggedright{\bfseries\fontsize{\csname HBwarn_text_size\endcsname}{\csname HBwarn_text_leading\endcsname}\selectfont\MakeUppercase{#2}}
  \end{tabularx}
\end{safetywarningbox}
}

% --------------------------------------------------
% OPERATING INSTRUCTIONS pill bar - parameterized
% --------------------------------------------------
\newcommand{\safetysubbar}[1]{%
  \begin{tcolorbox}[
    colback=BrandDark,
    colframe=BrandDark,
    arc=\csname HBsubbar_arc\endcsname,
    left=\csname HBsubbar_pad_lr\endcsname,
    right=\csname HBsubbar_pad_lr\endcsname,
    top=\csname HBsubbar_pad_tb\endcsname,
    bottom=\csname HBsubbar_pad_tb\endcsname,
    boxrule=0pt,
    width=\textwidth
  ]
  {\color{white}\bfseries\fontsize{\csname HBtitle_font_size\endcsname}{\csname HBtitle_font_leading\endcsname}\selectfont\MakeUppercase{#1}}
  \end{tcolorbox}
  \vspace{\csname HBsubbar_vspace_after\endcsname}
}

% --------------------------------------------------
% Two-column list env - parameterized
% --------------------------------------------------
\setlength{\columnsep}{\csname HBtwocol_sep\endcsname}
\newenvironment{safetytwocol}{%
  \begin{multicols}{2}
  \fontsize{\csname HBtwocol_font_size\endcsname}{\csname HBtwocol_font_leading\endcsname}\selectfont
}{%
  \end{multicols}
}

% --------------------------------------------------
% Section title pill (IMPORTANT SAFETY INFORMATION) - parameterized
% NOTE: use \textwidth to avoid Sphinx heading indent surprises
% --------------------------------------------------
\providecommand{\hbsectiontitle}[1]{#1}

\renewcommand{\hbsectiontitle}[1]{%
  \par\noindent
  \hspace*{-\leftskip}%
  \begin{tcolorbox}[
    colback=BrandDark,
    colframe=BrandDark,
    arc=\csname HBbrand_title_arc\endcsname,
    boxrule=0pt,
    left=\csname HBbrand_title_pad_lr\endcsname,
    right=\csname HBbrand_title_pad_lr\endcsname,
    top=\csname HBbrand_title_pad_tb\endcsname,
    bottom=\csname HBbrand_title_pad_tb\endcsname,
    width=\csname HBbrand_title_width\endcsname\textwidth,
    before skip=0mm,
    after skip=\csname HBbrand_title_vspace_after\endcsname
  ]
  {\color{white}\bfseries
   \fontsize{\csname HBtitle_font_size\endcsname}{\csname HBtitle_font_leading\endcsname}\selectfont
   \MakeUppercase{#1}}
  \end{tcolorbox}%
  \par\noindent
}



\titleformat{\section}{\normalfont}{}{0pt}{\hbsectiontitle}
\titlespacing*{\section}{0pt}{0pt}{\csname HBsection_after_fix\endcsname}
\setcounter{secnumdepth}{0}
